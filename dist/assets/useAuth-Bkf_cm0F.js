import{u as v,k as d,a,l as f,m,p as w}from"./index-rAF5i6Tv.js";const h=w(),x=()=>{const s=v(),t=d(),e={email:a(""),password:a(""),username:a(""),error:a(""),success:a(""),loading:a(!1)},l=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),n=r=>r.length>=6,i=r=>r.length>=3&&/^[a-zA-Z0-9_]+$/.test(r),u=()=>{e.error.value="",e.success.value=""};return{...e,login:async()=>{try{if(u(),e.loading.value=!0,!l(e.email.value))throw new Error("Por favor ingresa un email válido");if(!n(e.password.value))throw new Error("La contraseña debe tener al menos 6 caracteres");const{error:r}=await s.login(e.email.value,e.password.value);if(r)throw r;h.success("Login realizado con éxito");const o=s.profiles.length>0;t.push(o?"/profiles":"/settings")}catch(r){e.error.value=r.message||"Error al iniciar sesión"}finally{e.loading.value=!1}},register:async()=>{try{if(u(),e.loading.value=!0,!l(e.email.value))throw new Error("Por favor ingresa un email válido");if(!n(e.password.value))throw new Error("La contraseña debe tener al menos 6 caracteres");if(!i(e.username.value))throw new Error("El nombre de usuario solo puede contener letras, números y guiones bajos");const{data:r,error:o}=await f.executeQuery(supabase.from("users").select("id").eq("username",e.username.value).maybeSingle());if(o)throw o;if(r)throw new Error("El nombre de usuario ya está en uso");const{error:c,data:g}=await s.register({email:e.email.value,password:e.password.value,username:e.username.value});if(c)throw c;g?(await s.fetchProfiles(),t.push("/settings")):e.success.value="Registro exitoso. Revisá tu email para confirmar la cuenta."}catch(r){e.error.value=m.extractErrorMessage(r)||"Error en el registro"}finally{e.loading.value=!1}},logout:async()=>{try{e.loading.value=!0,await s.logout(),t.push("/login")}catch{e.error.value="Error al cerrar sesión"}finally{e.loading.value=!1}},validateEmail:l,validatePassword:n,validateUsername:i}};export{x as u};
