import{u as m,k as v,a,l as d,s as f,m as w,p as h}from"./index-B3C7ulGV.js";const p=h(),P=()=>{const s=m(),n=v(),e={email:a(""),password:a(""),username:a(""),error:a(""),success:a(""),loading:a(!1)},i=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),l=r=>r.length>=6,u=r=>r.length>=3&&/^[a-zA-Z0-9_]+$/.test(r),c=()=>{e.error.value="",e.success.value=""};return{...e,login:async()=>{try{if(c(),e.loading.value=!0,!i(e.email.value))throw new Error("Por favor ingresa un email válido");if(!l(e.password.value))throw new Error("La contraseña debe tener al menos 6 caracteres");const{error:r}=await s.login(e.email.value,e.password.value);if(r)throw r;p.success("Login realizado con éxito");const o=s.profiles.length>0;n.push(o?"/profiles":"/settings")}catch(r){e.error.value=r.message||"Error al iniciar sesión"}finally{e.loading.value=!1}},register:async()=>{try{if(c(),e.loading.value=!0,!i(e.email.value))throw new Error("Por favor ingresa un email válido");if(!l(e.password.value))throw new Error("La contraseña debe tener al menos 6 caracteres");if(!u(e.username.value))throw new Error("El nombre de usuario solo puede contener letras, números y guiones bajos");const{data:r,error:o}=await d.executeQuery(f.from("users").select("id").eq("username",e.username.value).maybeSingle());if(o)throw o;if(r)throw new Error("El nombre de usuario ya está en uso");const{error:t,data:g}=await s.register({email:e.email.value,password:e.password.value,username:e.username.value});if(t){if(t.message&&t.message.includes("Email not confirmed")){e.success.value="Registro exitoso. Revisá tu email para confirmar tu cuenta antes de iniciar sesión.";return}throw t}g?(await s.fetchProfiles(),n.push("/settings")):e.success.value="Registro exitoso. Revisá tu email para confirmar la cuenta."}catch(r){e.error.value=w.extractErrorMessage(r)||"Error en el registro"}finally{e.loading.value=!1}},logout:async()=>{try{e.loading.value=!0,await s.logout(),n.push("/login")}catch{e.error.value="Error al cerrar sesión"}finally{e.loading.value=!1}},validateEmail:i,validatePassword:l,validateUsername:u}};export{P as u};
